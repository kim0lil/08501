# maven

아파치의 메이븐은 자바용으로 설계 된 프로젝트 관리 툴입니다.

또한 메이븐은 ant를 대신할 용도록 개발 되었으며 자바를 개발하는 도중 필요한 의존성 관리와 빌드 기능을 가지고 있습니다.

이렇듯이 메이븐은 프로젝트의 전반적인 관리(통합 관리)를 위한 다양한 플러그인을 지원하고 있습니다.

이 장에서는 메이븐의 주요 플러그인과 메이븐을 다루는 방법을 다룰 예정입니다.

maven은 ant와 동일하게 `xml`파일을 지향하며 이 파일의 기본 이름은 pom.xml(project object model) 파일입니다.

그렇다면 차근 차근 따라 하면서 메이븐을 능숙하게 사용 할 수 있도록 해 보세요

## 메이븐의 기본 구조

먼저 알아야 될 것은 메이븐은 플러그인을 실행 시키는 프레임워크 기반의 툴이라는 것입니다.

(다양한 플러그인이 있으며 이 플러그인을 단지 실행하는 데 초점을 맞추며 따라서 플러그인이 하는 동작에는 관여 하지 않는 다는 것입니다.)

이점을 유의 하며 뒤쪽을 볼수 있도롭 합니다.

먼저 ant와 동일하게 xml파일을 만들고 최 상위 루트인 `project` 태그를 생성합니다.

[소스 보기](./sources/maven/step001.xml)

먼저 알야할 것이 있습니다.

메이븐은 프로젝트를 통합 관리 하는 툴이라고 말한 적이 있습니다.

이 떄 사용한 통합 관리라는 말은 프로젝트 자체의 관리도 겸한다는 것입니다.

(프로젝트의 관리는 여러 프로젝트 중에서 자신의 프로젝트를 구분하여야 합니다.)

따라서 프로젝트 전반에 걸쳐 사용할 고유한 아이디를 발급 해야 하며 이때 사용하는 구분자 로써

`groupId`의 `artifactId`에 등록 된 `version`을 사용합니다.

<< 표 1-1. 메이븐 기본 구분자 >>

|속성|설명|
|:---|:---|
|groupId|최상위 구분자로 웹 상에서 사용 되는 최소 구분자이며 보통은 도메인을 역순으로 하거나 또는 패키지에 따라 정의합니다.(예:org.education.spring, etc.edu.core)|
|artifactId|groupId가 웹상에서 사용 되는 최소 구분자라면 artifactId는 groupId내에서 사용하는 개별 프로젝트의 구분자입니다.|
|version|version은 동일한 groupId의 artifactId를 가진 프로젝트의 구분자입니다. 메이븐은 SNAPSHOT에 관하여 일반적 구조와는 다르게 관리 하고 있습니다.(뒤편에 다룸)|

따라서 프로젝트의 기본 구분자를 등록 해 보도록 하겠습니다.

[소스 보기](./sources/maven/step002.xml)

- - -

추가로

`name` 태그를 사용하여 프로젝트의 이름을 등록 할 수 있으며
`description` 태그를 사용하여 프로젝트의 주석을 등록 할 수 있습니다.

[소스 보기](./sources/maven/step003.xml)

- - -

이제 POM(Project Object Model)의 버전을 명시 해 줄 시간입니다.

현재 POM의 버전(LTS)은 4.0.0대로 사용 되고 있으니 4.0.0을 등록해 주도록 합니다.

버전 등록은 `modelVersion`의 태그를 사용합니다.

[소스 보기](./sources/maven/step004.xml)

maven을 사용하는 이유는 아래와 같습니다.

1. 작업 중인 프로젝트의 정보 관리(저장 되는 공간, 지속적인 버전링, 부분적 설정 적용 등)등록
2. 런타임 시 설정을 분리(fragment)하거나 사용 될 환경을 설정
3. 프로젝트의 사용 되는 의존성을 관리(이행적 의존 [모듈 간 의존성의 이해 관계 설정 및 대응], 라이브러리 캐싱, 토큰 검증 등 의존성 편의 기능)
4. 프로젝트의 배포 및 빌드 관리(빌드 시 사용하는 플러그인의 통합적 관리)

그렇다면 아래 기능에 따라 사용 되는 태그들이 있습니다.

하나하나 간력하게 살펴 보도록 하겠습니다.

먼저 프로젝트의 정보 관리는 통합적으로 관리 되도록 하며 하나의 `project` 라는 태그를 사용하여 명시 할 수 있습니다.
(이전까지 다루었으므로 생략 하겠습니다.)

다음으로는 설정을 적용 할 수 있도록 `properties` 라는 태그를 사용하여 등록 합니다.

[소스 보기](./sources/maven/step005.xml)

의존성을 관리 할 수 있도록 하나의 `dependencies` 태그를 지원합니다.

[소스 보기](./sources/maven/step006.xml)

빌드 시 사용할 플러그인을 관리 할 수 있도록 하나의 `build` 태그를 지원합니다.

[소스 보기](./sources/maven/step007.xml)

그 외에도 라이브러리가 보관 되어 있는 공간을 지정 할 수 있는 `repositories`와 의존성 처리를 위한 기본 설정을 등록 할 수 있는 `dependencyManagement` 등이 있으며 기본적인 내용을 다룬 다음 하나씩 다루어 보도록 하겠습니다.

그렇다면 먼저 간단하게 메시지를 출력 하도록 작성해 보겠습니다.

### echo

메시지를 출력 하기 위해서는 `echo` 플러그인을 사용 해야 합니다.

이 플러그인을 사용하기 위해서는 플러그인을 통합 관리하는 `build` 태그를 구성 한 다음 

`plugin` 태그를 사용하여 플러그인을 사용 하겠다고 선언 합니다.

[소스 보기](./sources/maven/step008.xml)

하나의 `build` 태그에서 여러개의 `plugin`이 선언 되어 관리 되기 때문에 `plugin` 태그를 감싸는 `plugins` 태그를 추가합니다.
(`plugin`은 여러 사용자에게 제공 받을 수 있으며 커스텀 하게도 사용할 수 있습니다.[커스텀 플러그인은 다음 장에서 다루어 보겠습니다.])

[소스 보기](./sources/maven/step009.xml)

현재 우리는 간단한 플러그인으로 `echo` 플러그인을 사용하여 `echo` 기능을 사용해 보도록 하겠습니다.

`echo`는 이전에`ant` 을 공부한 것을 토대로 `ant` 를 사용할 수 있는 `antrun` 플러그인을 사용하여 작성해 보겠습니다.

먼저 플러그인을 사용하기 위해서는 고유한 아이디를 등록 해야 합니다.

이 고유한 아이디는 groupId와 artifactId 그리고 version으로 구분 된다고 한적이 있습니다.

그렇다면 먼저 `antrun` 을 사용하기 위한 고유 정보를 아래와 같이 등록해 보도록 하겠습니다.

- - -

groupId : org.apache.maven.plugins

artifactId : maven-antrun-plugin

version : 1.8

- - -

따라서 앞서 작성한 `plugin` 에 각 고유한 값을 등록 합니다.

[소스 보기](./sources/maven/step010.xml)

각 플러그인은 하나 이상 실행 할 수 있도록 작성되며

이 플러그인에서 실행 가능한 영역을 작성하는 공간을

`execution` 이라고 합니다.

따라서 `execution` 을 등록 해 보도록 하겠습니다.

[소스 보기](./sources/maven/step011.xml)

`execution` 은 하나 이상 작성 될 수 있으므로 각 `execution` 태그를 감싸는 `executions` 태그를 사용하여 묶어 주도록 합니다.

[소스 보기](./sources/maven/step012.xml)

이제 실행 가능한 소스를 등록해 줄 차례 입니다.

실행 가능한 소스를 등록 하기 위해서는 `antrun` 플러그인에게 실행 가능한 코드를 넘겨 줘야 합니다.

이 와 같이 플러그인의 설정이 필요 한 경우 `configuration` 태그를 사용 하여 플러그인의 설정을 알릴 수 있습니다.

[소스 보기](./sources/maven/step013.xml)

그렇다면 이제 `ant` 문법을 사용하여 `Hello Ant In Maven` 이라는 출력을 해 보도록 하겠습니다.

[소스 보기](./sources/maven/step014.xml)

마지막으로 외부에서 우리가 작성한 코드가 실행 가능 하도록 실행 구문에 고유 `id` 를 등록 하겠습니다.

[소스 보기](./sources/maven/step015.xml)

이제 콘솔창(cmd)을 실행한 다음 해당 파일에 있는 곳에 간 다음 `mvn`명령어를 사용하여 메이븐을 실행해 봅니다.

```cmd
mvn -f step015.xml antrun:run@echo-in-maven
```

<< 이미지 1-1. 첫 메이븐 실행 >>

![이미지](./sources/maven/images/001.png)

## 메이븐과 플러그인

echo를 통하여 간단하게 메이븐을 사용해 보았을 것입니다.

하지만 간단히 `echo` 를 처리 하는 것만으로도 ant에 비해서 월등하게 많은 코드와 사용 된 태그들을 작성해야 했습니다.

만일 ant를 사용 했다면 아래와 같은 명령문을 사용하여 빌드를 할 수 있었을 것입니다.

```xml
<project default="antrun">
    <target name="antrun">
        <echo message="ant run" />
    </target>
</project>
```

하지만 메이븐으로 빌드를 하려면 웹 상에서 사용하는 고유 아이디를 등록 하고 버전을 사용 하는 등 많은 일이 필요 했습니다.

이처럼 불편하고 복잡한 일을 왜 하는 것일까요?

하나하나 알아 보도록 하겠습니다.

### 버전의 통합 관리

메이븐을 사용하면 버전을 통합적으로 관리 할 수 있습니다.

기본적으로 메이븐은 릴리즈와 스냅샷 라이브러리를 다르게 적용 합니다.

우리가 작성한 POM.xml파일을 보면 아래와 같이 버전을 명시 하는 곳이 있을 것입니다.

```xml

<version>0.0.1-SNAPSHOT</version>

```

이 때 사용하는 `SNAPSHOT` 은 아직 개발 도중이며 현재 변경이 가능한 버전이라는 의미 입니다.

따라서 어제 잘 돌아 가던 라이브러리가 오늘 아침 실행 할 때 에러를 발생 시킬 용의가 다분하다는 의미 이므로 주의하라는 뜻입니다.

이와 같은 상황이 발생하기 때문에 메이븐에서는 라이브러리를 관리하는 메이븐 저장소에서

release 버전과 snapshot 버전을 다르게 관리 하고 있습니다.

만일 `0.0.1-snapshot` 은 개발이 종료 될 경우 `0.0.1-release` 로 변경 하여 올려야 하며

사용 되었던 snapshot은 삭제 하여 버전링에 지장을 주지 않도록 주의 하여야 합니다.

이렇듯이 메이븐 저장소에서는 버전의 상태와 버전 자체를 관리 하도록 함으로 써

라이브러리들 간의 안정성을 효율적으로 관리 하도록 노력합니다.

간단하게 메이븐 저장소를 생성하여 저장소 관리를 해 보도록 하겠습니다.

### 메이븐 저장소(repository, Nexus)

메이븐은 메이븐 라이브러리를 관리 할 수 있는 저장소를 제공합니다.

이 라이브러리 저장소는 상단 모델링을 기본으로 하며 하위로 갈수록 세부적인 라이브러리들을 관리 하고 있습니다.

먼저 